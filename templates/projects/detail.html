{% extends "base.html" %}
{% load widget_tweaks %}
{% load i18n %}

{% block title %}{{ project.name }}{% endblock %}

{% block content %}
<div class="text-center mb-8">
  <h1 class="text-4xl font-bold text-gray-800 mb-2 tracking-wide">{{ project.name|upper }}</h1>
  <div class="w-32 h-1 bg-gradient-to-r from-gray-600 to-gray-400 mx-auto rounded-full"></div>
  <p class="text-gray-600 text-sm mt-2">{% trans "Created" %} {{ project.created_at|date:"M d, Y" }}</p>
</div>

<!-- Issue creation form -->
{% if user.is_authenticated %}
  <div class="max-w-md mx-auto bg-gray-700 rounded-lg shadow-xl p-6 mb-8">
    <h2 class="text-xl font-bold text-white mb-4 text-center">{% trans "Add New Issue" %}</h2>
    <form 
      method="post"
      action="{% url 'create_issue' project_pk=project.pk %}"
      hx-post="{% url 'create_issue' project_pk=project.pk %}"
      hx-target="#issues-list"
      hx-swap="afterbegin"
      class="space-y-4"
    >
      {% csrf_token %}
      
      <!-- Title field -->
      {% with issue_title_placeholder=_("Enter issue title") %}
      <div class="form-control">
        <label class="label">
          <span class="label-text text-white font-medium">{{ issue_form.title.label }}</span>
        </label>
        {% render_field issue_form.title class="input input-bordered w-full bg-gray-600 text-white border-gray-500 focus:border-gray-400" placeholder=issue_title_placeholder %}
      </div>
      {% endwith %}

      <!-- Description field -->
      {% with issue_desc_placeholder=_("Describe the issue") %}
      <div class="form-control">
        <label class="label">
          <span class="label-text text-white font-medium">{{ issue_form.description.label }}</span>
        </label>
        {% render_field issue_form.description class="textarea textarea-bordered w-full bg-gray-600 text-white border-gray-500 focus:border-gray-400" placeholder=issue_desc_placeholder rows="3" %}
      </div>
      {% endwith %}

      <!-- Assignee field: only for admin -->
      {% if user.role == "admin" %}
      <div class="form-control">
        <label class="label">
          <span class="label-text text-white font-medium">{{ issue_form.assignee.label }}</span>
        </label>
        {% render_field issue_form.assignee class="select select-bordered w-full bg-gray-600 text-white border-gray-500 focus:border-gray-400" %}
      </div>
      {% endif %}

      <button type="submit" class="btn bg-gray-200 text-gray-700 border-none rounded-lg shadow-md hover:bg-gray-300 hover:shadow-lg transition-all duration-300 ease-out transform hover:-translate-y-0.5 w-full px-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-4 h-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        {% trans "Add Issue" %}
      </button>
    </form>
  </div>
{% else %}
  <div class="text-center mb-8">
    <p class="text-gray-600">{% trans "You must" %} <a href="{% url 'login' %}" class="text-blue-600 underline hover:text-blue-800">{% trans "log in" %}</a> {% trans "to add an issue." %}</p>
  </div>
{% endif %}

<!-- Issues list -->
<div class="text-center mb-6">
  <h2 class="text-2xl font-bold text-gray-800 tracking-wide">{% trans "Issues" %}</h2>
  <div class="w-20 h-1 bg-gradient-to-r from-gray-600 to-gray-400 mx-auto rounded-full mt-2"></div>
</div>

<div id="issues-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {% for issue in issues %}
    {% include "issues/_issue_item.html" %}
  {% empty %}
    <div class="col-span-full text-center py-12">
      <div class="text-6xl mb-4">üìù</div>
      <p class="text-lg text-gray-600 mb-2">{% trans "No issues yet" %}</p>
      <p class="text-sm text-gray-500">{% trans "Start by creating your first issue" %}</p>
    </div>
  {% endfor %}
</div>
{% endblock %}
