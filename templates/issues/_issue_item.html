{% load i18n %}
<div class="space-y-0">
  <!-- Issue card -->
  <div class="card bg-gray-700 shadow-xl hover:scale-105 transition-transform duration-200 p-6 rounded-b-none" id="issue-{{ issue.pk }}">
    <div class="grid grid-cols-12 gap-4 mb-2">
      <!-- Wiersz 1: tytuÅ‚ -->
      <h3 class="col-span-12 text-white font-bold text-lg mb-1">{{ issue.title }}</h3>

      <!-- Wiersz 2: opis (lewo) + formularz zmiany statusu (prawo) -->
      <p class="col-span-9 text-white/70 text-sm mb-2">{{ issue.description|linebreaksbr|truncatewords:15 }}</p>
      <div class="col-span-3 flex justify-end">
        {% if user.is_authenticated and user.role == "assignee" or user.is_authenticated and user.role == "admin" %}
          <form 
            method="post"
            action="{% url 'change_status' pk=issue.pk %}"
            hx-post="{% url 'change_status' pk=issue.pk %}"
            hx-target="#issue-container-{{ issue.pk }}"
            hx-swap="outerHTML"
            class="flex gap-2"
          >
            {% csrf_token %}
            <select name="status" class="select select-bordered select-sm bg-gray-600 text-white border-gray-500 focus:border-gray-400">
              {% for val, label in issue.STATUS_CHOICES %}
                <option value="{{ val }}" {% if issue.status == val %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
            <button type="submit" class="btn btn-sm bg-gray-200 text-gray-700 border-none rounded-lg shadow-md hover:bg-gray-300 hover:shadow-lg transition-all duration-300 ease-out transform hover:-translate-y-0.5 px-4">
              {% trans "Update" %}
            </button>
          </form>
        {% endif %}
      </div>

      <!-- Wiersz 3: Assigned (lewo) + aktualny status (prawo, skrajnie) -->
      <div class="col-span-9 flex items-center">
        {% if issue.assignee %}
          <span class="badge badge-ghost text-white/60">{% trans "Assigned" %}: {{ issue.assignee.username }}</span>
        {% endif %}
      </div>
      <div class="col-span-3 flex items-center justify-end">
        <span class="badge badge-outline text-white border-white/30">{{ issue.get_status_display }}</span>
      </div>
    </div>

    <!-- Author w prawym dolnym rogu karty -->
    <div class="flex justify-end">
      {% if issue.author %}
        <span class="badge badge-ghost text-white/40">{% trans "Author" %}: {{ issue.author.username }}</span>
      {% endif %}
    </div>
  </div>

  <!-- Comments Section - OUTSIDE issue card but attached -->
  {% include 'issues/_comments_section.html' %}
</div>
