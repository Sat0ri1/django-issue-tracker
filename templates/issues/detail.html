{% extends "base.html" %}
{% load i18n %}
{% block title %}{{ issue.title }}{% endblock %}
{% block content %}

<div class="text-center mb-8">
  <h1 class="text-4xl font-bold text-gray-800 mb-2 tracking-wide">{{ issue.title }}</h1>
  <div class="w-24 h-1 bg-gradient-to-r from-gray-600 to-gray-400 mx-auto rounded-full"></div>
</div>

<div class="max-w-xl mx-auto bg-gray-700 rounded-lg shadow-xl p-8 mb-8">
  <p class="text-white/80 mb-2 whitespace-pre-line">{{ issue.description }}</p>
  <div class="flex flex-wrap gap-4 mb-2">
    <span class="badge badge-outline text-white border-white/30">{% trans "Status" %}: {{ issue.get_status_display }}</span>
    <span class="badge badge-ghost text-white/60">{% trans "Author" %}: {% if issue.author %}{{ issue.author.username }}{% else %}Anonymous{% endif %}</span>
  </div>
</div>

<!-- Collapsible comments section -->
<div class="max-w-xl mx-auto mb-8">
  <details class="bg-gray-100 rounded-lg shadow overflow-hidden">
    <summary class="cursor-pointer list-none px-4 py-3 flex items-center justify-between">
      <span class="font-semibold text-gray-800">
        {% blocktrans count comment_count=issue.comments.count %}
          Comments ({{ comment_count }})
        {% plural %}
          Comments ({{ comment_count }})
        {% endblocktrans %}
      </span>
      <span class="text-sm text-gray-500">{% trans "click to toggle" %}</span>
    </summary>

    <div class="px-4 pb-4 pt-2">
      <div id="comments-list" class="space-y-3">
        {% for comment in issue.comments.all %}
          {% include "issues/_comment_item.html" %}
        {% empty %}
          <p class="text-gray-500 text-center">{% trans "No comments" %}</p>
        {% endfor %}
      </div>

      {% if user.is_authenticated and user.role == "assignee" or user.is_authenticated and user.role == "admin" %}
        <div class="bg-gray-700 rounded-lg shadow-xl p-4 mt-4">
          <h3 class="text-base font-bold text-white mb-3">{% trans "Add a comment" %}</h3>
          <form 
              method="post"
              action="{% url 'add_comment' issue_pk=issue.pk %}"
              hx-post="{% url 'add_comment' issue_pk=issue.pk %}"
              hx-target="#comments-list"
              hx-swap="beforeend"
              class="space-y-3"
          >
              {% csrf_token %}
              {{ comment_form.as_p }}
              <button type="submit" class="btn btn-sm bg-gray-200 text-gray-700 border-none rounded-lg shadow-md hover:bg-gray-300 hover:shadow-lg transition-all duration-300 ease-out transform hover:-translate-y-0.5 px-4">
                {% trans "Add comment" %}
              </button>
          </form>
        </div>
      {% else %}
        {% if not user.is_authenticated %}
          <p class="text-gray-500 text-center mt-4">{% trans "You must" %} <a href="{% url 'login' %}" class="text-blue-600 underline hover:text-blue-800">{% trans "log in" %}</a> {% trans "to add a comment." %}</p>
        {% else %}
          <p class="text-gray-500 text-center mt-4">{% trans "Only assignees and admins can add comments." %}</p>
        {% endif %}
      {% endif %}
    </div>
  </details>
</div>

{% endblock %}
